vec myOldLoc;
vec myNewLoc = myOldLoc;
float r2 = 2*INTER_RAD;
foreach neighbourLoc
{
  vec toVec = myOldLoc-neighbourLoc;
  float separation = length(toVec);
  if(separation < r2)
  {
    float k = (separation<INTER_RAD)?REP_FORCE:ATT_FORCE;
    toVec = (separation<INTER_RAD)?-toVec:toVec;
    separation -= (separation<INTER_RAD)?INTER_RAD:r2;
    myNewLoc += k * separation * normalize(toVec);
  }
}
myNewLoc = clamp(myNewLoc, envMin, envMax);